#!/bin/bash

# Simple backup using cp -r (no rsync)
# Copies ~/.shortcuts (incl. .hidden) + ~/.bashrc directly to ~/termux-backup

SOURCE_SHORTCUTS="$HOME/.shortcuts"
SOURCE_BASHRC="$HOME/.bashrc"
DEST="$HOME/termux-backup"
COMMIT_MSG="Simple backup of ~/.shortcuts (incl .hidden) + .bashrc"

# Create destination if missing
mkdir -p "$DEST"

# If .hidden exists and is empty, add .gitkeep so git tracks it
HIDDEN="$SOURCE_SHORTCUTS/.hidden"
if [ -d "\( HIDDEN" ] && [ -z " \)(ls -A "$HIDDEN")" ]; then
    touch "$HIDDEN/.gitkeep"
    echo "# Ensures git tracks this folder" > "$HIDDEN/.gitkeep"
fi

echo "Copying ~/.shortcuts (including .hidden) to $DEST..."
cp -r "$SOURCE_SHORTCUTS" "$DEST/" || { echo "Copy failed!"; exit 1; }

echo "Copying ~/.bashrc to $DEST..."
cp -f "$SOURCE_BASHRC" "$DEST/" 2>/dev/null || echo "No .bashrc found, skipping"

cd "$DEST" || { echo "Cannot cd to $DEST"; exit 1; }

git add -A .

if git status --porcelain | grep -q .; then
    git commit -m "$COMMIT_MSG"
    echo "Committed."
else
    echo "No changes to commit."
fi

git push origin main 2>/dev/null || echo "Push failed - check git remote"

echo ""
echo "Backup complete!"
echo "Files are now directly in: $DEST/"
ls -a "$DEST"
echo ""
echo "Hidden folder status:"
[ -d "$DEST/.hidden" ] && ls -a "$DEST/.hidden" || echo ".hidden not found"
