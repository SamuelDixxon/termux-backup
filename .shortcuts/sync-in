#!/data/data/com.termux/files/usr/bin/bash
set -euo pipefail

D="$HOME/termux-backup"
S="$HOME/.shortcuts"
B="$HOME/.bashrc"
DEVICE=$(getprop ro.product.model | tr -d ' ')

echo "ðŸ“± Device: $DEVICE"

# 1. Pull latest "Source of Truth" from GitHub
echo "ðŸ“¥ Pulling latest Cloud data..."
cd "$D"
git fetch origin main
git reset --hard origin/main  # Force local backup folder to match GitHub exactly

# 2. Sync Backup -> System with DELETE
echo "ðŸ”„ Mirroring Backup to System (Deleting junk)..."
# rsync is the best tool for this. If not installed: pkg install rsync
# This makes ~/.shortcuts EXACTLY match ~/termux-backup/.shortcuts
rsync -rtv --delete "$D/.shortcuts/" "$S/"

# 3. Update .bashrc if newer
if [ "$D/.bashrc" -nt "$B" ]; then
    echo "ðŸ†• Updating .bashrc..."
    cp -f "$D/.bashrc" "$B"
fi

echo -e "\nâœ¨ System is now an identical clone of Upstream."
